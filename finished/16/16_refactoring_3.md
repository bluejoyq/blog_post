# [소프트웨어 공학]리팩터링 3장
전 단원에서는 리팩터링의 전반적인 원칙에 대해 배웠다. 이번에는 리팩터링을 언제 시작하고 언제 그만할지를 판단하는 법을 배워볼 것이다.
리팩터링할 시점을 설명하는데에 `냄새`란 표현을 사용한다. 냄새가 나는 시작 시점을 찾는 법을 알아본다. 그리고 종료할 시점보다는 리팩터링하면 해결할 문제의 징후를 표현하겠다.
*(이게 진짜 무슨 소리냐)*
## 3.1 리팩터링의 정의
코드를 명료하게 표현하는데 가장 중요한 요소 하나는 `이름`이다. 함수, 모듈, 변수, 클래스 등은 그 이름만 보고도 무슨 일을 하고 어떻게 사용할지 명확히 알도록 이름을 지어야 한다.

그러나 이름 짓기는 정말 어렵다. 그렇기에 우리가 가장 많이 사용하는 리팩터링 `함수 선언 바꾸기`, `변수 이름 바꾸기`, `필드 이름 바꾸기`처럼 이름을 바꾸는 리팩터링들이다. 

마땅한 이름이 떠오르지 않는다면 설계에 더 근본적인 문제가 숨어 있을 가능성이 있다. 그러므로 혼란스러운 이름을 잘 정리해서 코드를 간결하게 만들자.

### 코멘트
이름 짓는건 정말 어렵다. 영어 공부를 좀 해야지 어휘 폭이 넓어질 듯.

## 3.2 중복 코드
똑같은 코드 구조가 여러 곳에서 반복된다면 하나로 통합해 더 나은 프로그램을 만들 수 있다.

## 3.3 긴 함수
### 짧은 함수의 중요성
짧은 함수들로 이루어진 프로그램은 `간접 호출(indirection)`의 효과, 즉 코드를 이해하고, 공유하고, 선택하기 쉬워진다는 장점을 가진다. 

예전에는 서브루틴을 호출하는 비용이 컸기 때문에 짧은 함수를 꺼렸다. 그렇지만 지금은 ㄱㅊ.

코드를 읽는 사람 입장에서는 함수가 하는 일을 파악하기 위해 왔다 갔다 해야하므로 여전히 부담이 되지만 함수 선언부와 호출부를 빠르게 이동하거나 동시에 보여주는 개발 환경을  활용하면 이 부담이 줄어든다. 하지만 짧은 함수로 구성된 코드를 쉽게 만드는 가장 확실한 방법은 좋은 이름이다. **함수 이름을 잘 지어두면 본문 코드를 볼 이유가 사라진다.**

적극적으로 함수를 쪼개야 한다. 주석을 달아야 할 만한 부분은 무조건 함수로 만든다. 그 함수 본문에는 원래 주석으로 설명하려던 코드를 담고, **함수 이름은 동작 방식이 아닌 `의도(intention)`이 드러나게 짓는다.**

원래 코드보다 길어지더라도 함수로 뽑아야 한다. 단, 함수 이름에 코드의 목적을 드러내야 한다. 무엇을 하는지를 코드가 잘 설명해주지 못할 수록 함수로 만드는 게 유리하다.

### 짧은 함수 만들기
함수를 짧게 만드는 작업으 99%는 `함수 추출하기`가 차지한다. 함수 본문에서 따로 묶어 빼면 좋은 코드 덩어리를 찾아 새로운 함수로 만드는 것이다.

함수가 매개변수와 임시 변수를 많이 사용한다면 추출 작업에 방해가 된다. *(테스트에도 방해가 되겠죠!)* 그러므로 `임시 변수를 질의 함수로 바꾸기`로 임시 변수의 수를, `매개변수 객체 만들기`와 `객체 통째로 넘기기`로 매개변수의 수를 줄이자.

이 리팩터링을 적용해도 여전히 임시 변수와 매개변수가 너무 많다면 더 큰 수술이라 할 수 있는 `함수를 명령으로 바꾸기`를 고려해보자.

### 추출할 코드 찾기
좋은 방법은 주석을 참고하는 것이다. 주석은 코드만으로 목적을 이해하기 어려운 부분에 달려 있는 경우가 많다. 이런 주석을 찾으면 주석이 설명하는 코드와 함께 함수로 빼내고, 함수 이름은 주석 내용을 토대로 짓는다. 

**코드가 단 한줄이어도 따로 설명할 필요가 있다면 함수로 추출하는게 좋다.**

조건문이나 반복문도 추출 대상의 실마리를 제공한다. 조건문은 `조건문 분해하기`로 대응한다. 거대한 switch문을 구성하는 case문마다 `함수 추출하기`를 적용해서 각 case의 본문을 함수 호출문 하나로 바꾼다. 같은 조건을 기준으로 나뉘는 switch문이 여러 개라면 `조건문을 다형성으로 바꾸기`를 적용한다.

반복문도 그 안의 코드와 함께 추출해서 독립된 함수로 만든다. 추출한 반복문 코드에 적합한 이름이 떠오르지 않는다면 성격이 다른 두 가지 작업을 섞여 있기 때문일 수 있다. 이럴 때는 `반복문 쪼개기`를 적용해서 작업을 분리한다.